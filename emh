#!/bin/bash

order=$1
emhDir=`dirname "$(readlink -f "$0")"`

if [[ $order = 'start' ]] 
then
	echo "Optimizing system:"
	sudo $emhDir/Startup/enableKeyboardAndMouse.perl
	emh bright
fi

if [[ $order = 'update' ]] 
then
	echo "Updating System, please enter sudo password:"
	sudo apt update
	if [ $(apt-get -s upgrade | awk '/^Inst/ { print $2 }' | wc -l) -gt 0 ]
	then
		sudo apt upgrade
	fi
fi

if [[ $order = 'run' ]]
then
	echo "Running config"
	python3  $emhDir/runProject.py ${@:2}
fi

if [[ $order = 'crawl' ]]
then
	echo "Crawling Website"
	$emhDir/webCrawl.sh ${@:2} #crawls website with input of 'emh crawl {URL} {Directory to store data}'
fi

if [[ $order = 'bright' ]]
then
	defaultBrightness=`python3  $emhDir/getConfig.py "defaultBrightness" 0.3`

	echo "Changing Brightness"
	if [ $# -gt 1 ]
	then
		xrandr --output eDP-1 --brightness ${@:2} #TODO grab laptop screen name regardless of nvidia or intel graphics
	else
		xrandr --output eDP-1 --brightness $defaultBrightness
	fi
fi

if [[ $order = 'mount' ]]
then
	mkdir -p ~/OSUengr
	sshfs hamptone@access.engr.oregonstate.edu:/nfs/stak/users/hamptone ~/OSUengr
fi

if [[ $order = 'unmount' ]]
then
	fusermount -u ~/OSUengr
	rmdir ~/OSUengr
fi

if [[ $order = 'connect' ]]
then
	#TODO move get config to function
	location=`python3  $emhDir/getConfig.py "connect.$2"`
	if [ $? -eq 0 ]
	then
		ssh $location
	else
		echo "Couldn't find a config location for that server ($2)"
	fi
fi

